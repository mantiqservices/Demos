<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MANTIQ | Business Services Demos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --mantiq-cyan: #38bdf8;
            --mantiq-navy: #001e3c;
        }

        body {
            font-family: 'Plus Jakarta Sans', 'Noto Sans Arabic', sans-serif;
            transition: background-color 0.3s ease;
        }

        [dir="rtl"] {
            font-family: 'Noto Sans Arabic', 'Plus Jakarta Sans', sans-serif;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 15s linear infinite; }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .locked-ui {
            user-select: none;
            -webkit-user-select: none;
        }

        .card-glow:hover {
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.15);
        }

        .modal-overlay {
            background-color: rgba(0, 30, 60, 0.7);
            backdrop-filter: blur(8px);
        }

        .mobile-sidebar-active { transform: translateX(0) !important; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        mantiq: {
                            cyan: '#38bdf8',
                            navy: '#001e3c',
                            navyLight: '#002b55'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen locked-ui overflow-x-hidden" dir="ltr">

    <div id="app" class="min-h-screen">
        <!-- Content injected by JavaScript -->
    </div>

    <div id="notification-container" class="fixed bottom-10 right-10 z-[110] space-y-3"></div>

    <script>
        // --- 1. Constants ---
        const MODULES = {
            LANDING: 'landing',
            CRM: 'crm',
            SALES: 'sales',
            HR: 'hr',
            FINANCE: 'finance'
        };

        const UI = {
            en: {
                subtitle: "For Business Services Demos",
                description: "Unified intelligence system for MENA enterprises. High-performance trackers localized for Egypt and EGP currency standards.",
                launch: "Demo",
                dashboard: "Dashboard",
                controlCenter: "Control Center",
                active: "Active",
                growth: "Growth",
                volume: "Volume",
                assets: "Assets",
                status: "Status",
                verified: "Verified",
                demoEnv: "Demo Environment",
                search: "Global search...",
                export: "Export",
                addRecord: "Add Record",
                cancel: "Cancel",
                confirm: "Confirm",
                syncing: "Syncing",
                returnHome: "Return Home",
                restricted: "Security: Restricted action.",
                blocked: "Security Protocol: Developer Access Blocked.",
                role: "Super Admin",
                action: "Action",
                submit: "Submit Data"
            },
            ar: {
                subtitle: "لخدمات الأعمال",
                description: "انظمة لادارة اقسام شركتك ",
                launch: "لروئية عينة ",
                dashboard: "لوحة القيادة",
                controlCenter: "مركز التحكم",
                active: "نشط",
                growth: "النمو",
                volume: "الحجم",
                assets: "الأصول",
                status: "الحالة",
                verified: "تم التحقق",
                demoEnv: "بيئة العرض",
                search: "بحث شامل...",
                export: "سحب البيانات",
                addRecord: "إضافة سجل",
                cancel: "إلغاء",
                confirm: "تأكيد",
                syncing: "جاري المزامنة",
                returnHome: "العودة للرئيسية",
                restricted: "أمن: إجراء مقيد.",
                blocked: "بروتوكول أمن: تم حظر وصول المطورين.",
                role: "مدير نظام",
                action: "الإجراء",
                submit: "إرسال البيانات"
            }
        };

        const SYSTEM_MAP = {
            [MODULES.CRM]: {
                title: { en: "CRM Tracker", ar: "متتبع العملاء" },
                nav: [
                    { id: 'dashboard', label: { en: 'Dashboard', ar: 'لوحة القيادة' }, icon: 'layout-dashboard' },
                    { id: 'leads', label: { en: 'Leads', ar: 'العملاء المحتملون' }, icon: 'user-plus', tableCols: { en: ['Lead ID', 'Name', 'Company', 'Phone', 'Source', 'Status'], ar: ['المعرف', 'الاسم', 'الشركة', 'الهاتف', 'المصدر', 'الحالة'] } },
                    { id: 'customers', label: { en: 'Customers', ar: 'العملاء' }, icon: 'users', tableCols: { en: ['Customer ID', 'Company', 'Industry', 'Email', 'Type', 'Revenue'], ar: ['المعرف', 'الشركة', 'الصناعة', 'الايميل', 'النوع', 'الإيراد'] } },
                    { id: 'contacts', label: { en: 'Contacts', ar: 'جهات الاتصال' }, icon: 'phone', tableCols: { en: ['Contact ID', 'Name', 'Job Title', 'Company', 'Mobile'], ar: ['المعرف', 'الاسم', 'المنصب', 'الشركة', 'الهاتف'] } },
                    { id: 'deals', label: { en: 'Deals', ar: 'الصفقات' }, icon: 'briefcase', tableCols: { en: ['Deal ID', 'Deal Name', 'Account', 'Value', 'Stage', 'Probability'], ar: ['المعرف', 'العنوان', 'الحساب', 'القيمة', 'المرحلة', 'الاحتمالية'] } },
                    { id: 'pipeline', label: { en: 'Sales Pipeline', ar: 'المسار البيعي' }, icon: 'kanban', tableCols: { en: ['Stage Name', 'Order', 'Deals Count', 'Total Value'], ar: ['المرحلة', 'الترتيب', 'عدد الصفقات', 'القيمة'] } },
                    { id: 'activities', label: { en: 'Activities', ar: 'الأنشطة' }, icon: 'clipboard-list', tableCols: { en: ['Activity ID', 'Type', 'Subject', 'Due Date', 'Status'], ar: ['المعرف', 'النوع', 'الموضوع', 'الموعد', 'الحالة'] } },
                    { id: 'reminders', label: { en: 'Reminders', ar: 'التذكيرات' }, icon: 'bell', tableCols: { en: ['Reminder ID', 'Record', 'Date', 'Time', 'Status'], ar: ['المعرف', 'السجل', 'التاريخ', 'الوقت', 'الحالة'] } },
                    { id: 'notes', label: { en: 'Notes', ar: 'الملاحظات' }, icon: 'sticky-note', tableCols: { en: ['Note ID', 'Linked To', 'Created By', 'Date'], ar: ['المعرف', 'الارتباط', 'الكاتب', 'التاريخ'] } },
                    { id: 'communication', label: { en: 'Communication', ar: 'التواصل' }, icon: 'mail', tableCols: { en: ['Email/Call ID', 'Type', 'From/To', 'Subject', 'Date'], ar: ['المعرف', 'النوع', 'من/إلى', 'الموضوع', 'التاريخ'] } },
                    { id: 'reports', label: { en: 'Reports', ar: 'التقارير' }, icon: 'bar-chart-3', tableCols: { en: ['Report Type', 'Value', 'Growth %', 'Date Range'], ar: ['نوع التقرير', 'القيمة', 'النمو', 'الفترة'] } },
                    { id: 'settings', label: { en: 'User Roles', ar: 'أدوار المستخدمين' }, icon: 'settings', tableCols: { en: ['User Name', 'Email', 'Role', 'Status'], ar: ['الاسم', 'الايميل', 'الدور', 'الحالة'] } }
                ]
            },
            [MODULES.HR]: {
                title: { en: "HR System", ar: "نظام الموارد البشرية" },
                nav: [
                    { id: 'dashboard', label: { en: 'Dashboard', ar: 'لوحة القيادة' }, icon: 'layout-dashboard' },
                    { id: 'directory', label: { en: 'Employees', ar: 'دليل الموظفين' }, icon: 'users', tableCols: { en: ['E-ID', 'Full Name', 'Job Title', 'Dept', 'Status'], ar: ['المعرف', 'الاسم', 'المنصب', 'القسم', 'الحالة'] } },
                    { id: 'profile', label: { en: 'Profile View', ar: 'عرض الملف' }, icon: 'user', tableCols: { en: ['Category', 'Field Name', 'Information'], ar: ['الفئة', 'الحقل', 'المعلومات'] } },
                    { id: 'attendance', label: { en: 'Attendance', ar: 'الحضور والانصراف' }, icon: 'clock', tableCols: { en: ['Date', 'Employee', 'In', 'Out', 'Hours', 'Status'], ar: ['التاريخ', 'الموظف', 'دخول', 'خروج', 'ساعات', 'الحالة'] } },
                    { id: 'leaves', label: { en: 'Leaves', ar: 'الإجازات' }, icon: 'calendar', tableCols: { en: ['Leave ID', 'Employee', 'Type', 'Start', 'End', 'Status'], ar: ['المعرف', 'الموظف', 'النوع', 'البداية', 'النهاية', 'الحالة'] } },
                    { id: 'payroll', label: { en: 'Payroll', ar: 'الرواتب' }, icon: 'wallet', tableCols: { en: ['Month', 'Employee', 'Salary', 'Deductions', 'Net', 'Status'], ar: ['الشهر', 'الموظف', 'الراتب', 'الخصومات', 'الصافي', 'الحالة'] } },
                    { id: 'contracts', label: { en: 'Contracts', ar: 'العقود' }, icon: 'file-text', tableCols: { en: ['Contract ID', 'Employee', 'Type', 'End Date', 'Status'], ar: ['المعرف', 'الموظف', 'النوع', 'النهاية', 'الحالة'] } },
                    { id: 'recruitment', label: { en: 'Recruitment', ar: 'التوظيف' }, icon: 'user-plus', tableCols: { en: ['Job Title', 'Department', 'Applicants', 'Stage', 'Status'], ar: ['المنصب', 'القسم', 'المتقدمين', 'المرحلة', 'الحالة'] } },
                    { id: 'performance', label: { en: 'Performance', ar: 'الأداء' }, icon: 'trending-up', tableCols: { en: ['Employee', 'Reviewer', 'Score (1-5)', 'Period'], ar: ['الموظف', 'المقيم', 'التقييم', 'الفترة'] } },
                    { id: 'training', label: { en: 'Training', ar: 'التدريب' }, icon: 'graduation-cap', tableCols: { en: ['Training Name', 'Provider', 'Enrollees', 'Progress'], ar: ['الدورة', 'المزود', 'المسجلين', 'التقدم'] } },
                    { id: 'warnings', label: { en: 'Warnings', ar: 'الجزاءات' }, icon: 'alert-triangle', tableCols: { en: ['Record ID', 'Employee', 'Type', 'Reason', 'Date'], ar: ['المعرف', 'الموظف', 'النوع', 'السبب', 'التاريخ'] } },
                    { id: 'resignation', label: { en: 'Termination', ar: 'إنهاء الخدمة' }, icon: 'log-out', tableCols: { en: ['Employee', 'Exit Date', 'Reason', 'Clearance'], ar: ['الموظف', 'التاريخ', 'السبب', 'المخالصة'] } },
                    { id: 'reports', label: { en: 'HR Reports', ar: 'تقارير الموارد' }, icon: 'bar-chart-3', tableCols: { en: ['Metric', 'Current Value', 'Target', 'Status'], ar: ['المؤشر', 'القيمة', 'المستهدف', 'الحالة'] } },
                    { id: 'settings', label: { en: 'HR Settings', ar: 'إعدادات الموارد' }, icon: 'settings', tableCols: { en: ['Rule Name', 'Value', 'Applies To'], ar: ['القاعدة', 'القيمة', 'تطبق على'] } }
                ]
            },
            [MODULES.FINANCE]: {
                title: { en: "Finance Tracker", ar: " المالية" },
                nav: [
                    { id: 'dashboard', label: { en: 'Dashboard', ar: 'لوحة القيادة' }, icon: 'layout-dashboard' },
                    { id: 'income', label: { en: 'Income', ar: 'الإيرادات' }, icon: 'arrow-up-right', tableCols: { en: ['Income ID', 'Category', 'Source', 'Amount', 'Date', 'Status'], ar: ['المعرف', 'الفئة', 'المصدر', 'المبلغ', 'التاريخ', 'الحالة'] } },
                    { id: 'expenses', label: { en: 'Expenses', ar: 'المصاريف' }, icon: 'arrow-down-right', tableCols: { en: ['Expense ID', 'Vendor', 'Category', 'Amount', 'Method', 'Status'], ar: ['المعرف', 'المورد', 'الفئة', 'المبلغ', 'الطريقة', 'الحالة'] } },
                    { id: 'invoices', label: { en: 'Invoices', ar: 'الفواتير' }, icon: 'file-signature', tableCols: { en: ['Inv #', 'Client', 'Due Date', 'Total', 'Amount Paid', 'Status'], ar: ['رقم الفاتورة', 'العميل', 'الموعد', 'الإجمالي', 'المدفوع', 'الحالة'] } },
                    { id: 'bills', label: { en: 'Bills', ar: 'الفواتير المستحقة' }, icon: 'receipt', tableCols: { en: ['Bill #', 'Vendor', 'Due Date', 'Total', 'Status'], ar: ['رقم الفاتورة', 'المورد', 'الموعد', 'الإجمالي', 'الحالة'] } },
                    { id: 'payments', label: { en: 'Payments', ar: 'المدفوعات' }, icon: 'credit-card', tableCols: { en: ['Payment ID', 'Payer/Payee', 'Amount', 'Method', 'Date'], ar: ['المعرف', 'المرسل/المستلم', 'المبلغ', 'الطريقة', 'التاريخ'] } },
                    { id: 'wallets', label: { en: 'Wallets', ar: 'المحافظ' }, icon: 'wallet', tableCols: { en: ['Account Name', 'Type', 'Currency', 'Balance'], ar: ['اسم الحساب', 'النوع', 'العملة', 'الرصيد'] } },
                    { id: 'cashflow', label: { en: 'Cash Flow', ar: 'التدفق المالي' }, icon: 'trending-up', tableCols: { en: ['Month', 'Inflow', 'Outflow', 'Net Flow'], ar: ['الشهر', 'الوارد', 'الصادر', 'الصافي'] } },
                    { id: 'budgeting', label: { en: 'Budgeting', ar: 'الميزانية' }, icon: 'pie-chart', tableCols: { en: ['Category', 'Budget', 'Actual Spent', 'Usage %'], ar: ['الفئة', 'الميزانية', 'المنفق', 'الاستخدام'] } },
                    { id: 'taxes', label: { en: 'Taxes', ar: 'الضرائب' }, icon: 'shield-check', tableCols: { en: ['Period', 'Tax Type', 'Base Amount', 'VAT', 'Status'], ar: ['الفترة', 'النوع', 'الأساس', 'القيمة المضافة', 'الحالة'] } },
                    { id: 'profitloss', label: { en: 'P&L', ar: 'الأرباح والخسائر' }, icon: 'bar-chart-2', tableCols: { en: ['Label', 'This Period', 'Last Period'], ar: ['البند', 'الفترة الحالية', 'الفترة الماضية'] } },
                    { id: 'financial_reports', label: { en: 'Reports', ar: 'التقارير المالية' }, icon: 'file-text', tableCols: { en: ['Title', 'Format', 'Generated Date'], ar: ['العنوان', 'التنسيق', 'تاريخ الإنشاء'] } },
                    { id: 'export', label: { en: 'Export', ar: 'تصدير' }, icon: 'download', tableCols: { en: ['File Name', 'Module', 'Size', 'Date'], ar: ['اسم الملف', 'الوحدة', 'الحجم', 'التاريخ'] } },
                    { id: 'settings', label: { en: 'Settings', ar: 'الإعدادات' }, icon: 'settings', tableCols: { en: ['Option', 'Configuration', 'Status'], ar: ['الخيار', 'الإعداد', 'الحالة'] } }
                ]
            },
            [MODULES.SALES]: {
                title: { en: "Sales Tracker", ar: " المبيعات" },
                nav: [
                    { id: 'dashboard', label: { en: 'Dashboard', ar: 'لوحة القيادة' }, icon: 'layout-dashboard' },
                    { id: 'leads', label: { en: 'Leads', ar: 'العملاء المهتمون' }, icon: 'user-plus', tableCols: { en: ['Name', 'Source', 'Status', 'Rep'], ar: ['الاسم', 'المصدر', 'الحالة', 'المندوب'] } },
                    { id: 'opportunities', label: { en: 'Opportunities', ar: 'الفرص' }, icon: 'briefcase', tableCols: { en: ['Project', 'Value', 'Prob %', 'Close Date'], ar: ['المشروع', 'القيمة', 'الاحتمالية', 'تاريخ الإغلاق'] } },
                    { id: 'quotations', label: { en: 'Quotations', ar: 'عروض الأسعار' }, icon: 'file-text', tableCols: { en: ['Quote ID', 'Client', 'Grand Total', 'Status'], ar: ['المعرف', 'العميل', 'الإجمالي', 'الحالة'] } },
                    { id: 'orders', label: { en: 'Orders', ar: 'الطلبات' }, icon: 'package', tableCols: { en: ['Order ID', 'Customer', 'Delivery', 'Status'], ar: ['المعرف', 'العميل', 'التوصيل', 'الحالة'] } },
                    { id: 'invoices', label: { en: 'Invoices', ar: 'الفواتير' }, icon: 'file-signature', tableCols: { en: ['Invoice ID', 'Customer', 'Total', 'Due'], ar: ['المعرف', 'العميل', 'الإجمالي', 'الاستحقاق'] } },
                    { id: 'products', label: { en: 'Products', ar: 'المنتجات' }, icon: 'layers', tableCols: { en: ['Name', 'SKU', 'Category', 'Stock', 'Price'], ar: ['الاسم', 'SKU', 'الفئة', 'المخزون', 'السعر'] } },
                    { id: 'pricing', label: { en: 'Pricing Rules', ar: 'قواعد التسعير' }, icon: 'tag', tableCols: { en: ['Plan Name', 'Segment', 'Rate', 'Valid To'], ar: ['الخطة', 'الشريحة', 'السعر', 'صالح حتى'] } },
                    { id: 'pipeline', label: { en: 'Sales Pipeline', ar: 'المسار' }, icon: 'kanban', tableCols: { en: ['Stage', 'Order', 'Value'], ar: ['المرحلة', 'الترتيب', 'القيمة'] } },
                    { id: 'targets', label: { en: 'Sales Targets', ar: 'الأهداف' }, icon: 'target', tableCols: { en: ['Sales Rep', 'Target Revenue', 'Achieved', '% Achieved'], ar: ['المندوب', 'المستهدف', 'المحقق', 'النسبة'] } },
                    { id: 'commissions', label: { en: 'Commissions', ar: 'العمولات' }, icon: 'dollar-sign', tableCols: { en: ['Rep Name', 'Revenue', 'Comm Amount', 'Status'], ar: ['المندوب', 'الإيراد', 'العمولة', 'الحالة'] } },
                    { id: 'customers', label: { en: 'Customers', ar: 'العملاء' }, icon: 'users', tableCols: { en: ['Company', 'Contact', 'Since', 'Total Revenue'], ar: ['الشركة', 'المسؤول', 'منذ', 'إجمالي المبيعات'] } },
                    { id: 'reports', label: { en: 'Sales Reports', ar: 'تقارير المبيعات' }, icon: 'bar-chart-3', tableCols: { en: ['KPI Indicator', 'Current Value', 'Target'], ar: ['المؤشر', 'القيمة', 'المستهدف'] } },
                    { id: 'settings', label: { en: 'Settings', ar: 'الإعدادات' }, icon: 'settings', tableCols: { en: ['Configuration Key', 'Value', 'Last Sync'], ar: ['مفتاح الإعداد', 'القيمة', 'آخر مزامنة'] } }
                ]
            }
        };

        // --- 3. System State ---
        let state = {
            module: MODULES.LANDING,
            page: 'dashboard',
            darkMode: false,
            language: 'en',
            isModalOpen: false,
            isMobileMenuOpen: false,
            user: { initials: 'KA' },
            data: {}
        };

        const _t = (en, ar) => state.language === 'en' ? en : ar;
        const ut = (key) => UI[state.language][key];

        // --- 4. Logic Functions ---

        function initData() {
            // Pre-defined realistic data to ensure no "Sample Data" remains
            const REAL_NAMES = ["Ahmed Sharaf", "Mona Zaki", "Kareem Abdelaziz", "Sara El-Gohary", "Youssef El-Shamy", "Omar Khairat", "Layla Eloui", "Tarek El-Sheikh"];
            const REAL_COMPANIES = ["Cairo Tech Solutions", "Giza Systems", "Nile Logistics", "Delta Foods", "Alexandria Steel", "Suez Canal Energy", "Red Sea Tourism", "PetroJet"];

            Object.keys(SYSTEM_MAP).forEach(mod => {
                state.data[mod] = {};
                SYSTEM_MAP[mod].nav.forEach(page => {
                    if (page.id !== 'dashboard') {
                        state.data[mod][page.id] = [];
                        
                        // Create 3 realistic rows for each page
                        for(let i=0; i<3; i++) {
                            const row = {};
                            (page.tableCols.en).forEach(col => {
                                let val = "";
                                if (col.includes('ID') || col.includes('#')) val = (1024 + i).toString();
                                else if (col.includes('Name')) val = REAL_NAMES[(idx = (i + Math.floor(Math.random() * 5)) % REAL_NAMES.length)];
                                else if (col.includes('Company') || col.includes('Client') || col.includes('Vendor')) val = REAL_COMPANIES[(i + Math.floor(Math.random() * 5)) % REAL_COMPANIES.length];
                                else if (col.includes('Phone') || col.includes('Mobile')) val = "010" + Math.floor(10000000 + Math.random() * 90000000);
                                else if (col.includes('Email')) val = REAL_NAMES[i % REAL_NAMES.length].toLowerCase().replace(" ", ".") + "@example.com";
                                else if (col.includes('Value') || col.includes('Amount') || col.includes('Salary') || col.includes('Revenue')) val = (Math.floor(Math.random() * 150) + 10) + ",000 EGP";
                                else if (col.includes('Status')) val = ["Active", "Pending", "Completed", "Paid"][i % 4];
                                else if (col.includes('Date')) val = "2024-02-" + (10 + i);
                                else if (col.includes('Stage')) val = ["Discovery", "Proposal", "Negotiation"][i % 3];
                                else if (col.includes('Source')) val = ["Website", "LinkedIn", "Referral"][i % 3];
                                else if (col.includes('Job Title')) val = ["CTO", "HR Lead", "Sales Manager", "Dev Ops"][i % 4];
                                else if (col.includes('Dept') || col.includes('Category')) val = ["Technology", "Operations", "Finance", "Sales"][i % 4];
                                else val = state.language === 'ar' ? "بيانات حقيقية" : "Verified Entry";
                                row[col] = val;
                            });
                            state.data[mod][page.id].push(row);
                        }
                    }
                });
            });
        }

        function pushNotify(msg) {
            const container = document.getElementById('notification-container');
            const toast = document.createElement('div');
            toast.className = 'bg-mantiq-navy dark:bg-white text-white dark:text-mantiq-navy px-8 py-5 rounded-3xl shadow-2xl flex items-center gap-4 fade-in border-l-4 border-mantiq-cyan transition-all duration-300';
            toast.innerHTML = `<i data-lucide="shield-check" class="text-mantiq-cyan"></i><span class="text-sm font-bold">${msg}</span>`;
            container.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateY(10px)'; setTimeout(() => toast.remove(), 500); }, 3000);
        }

        function setLanguage(l) {
            state.language = l;
            document.body.dir = l === 'ar' ? 'rtl' : 'ltr';
            render();
        }

        function setModule(m) {
            state.module = m;
            state.page = 'dashboard';
            state.isMobileMenuOpen = false;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function setPage(p) {
            state.page = p;
            state.isMobileMenuOpen = false;
            render();
        }

        function toggleDarkMode() {
            state.darkMode = !state.darkMode;
            document.documentElement.classList.toggle('dark', state.darkMode);
            render();
        }

        function handleAddData(e) {
            if(e) e.preventDefault();
            const form = document.getElementById('add-record-form');
            const formData = new FormData(form);
            const newRecord = {};
            formData.forEach((value, key) => { newRecord[key] = value || "-"; });
            
            state.data[state.module][state.page].unshift(newRecord);
            pushNotify(state.language === 'ar' ? "تم حفظ البيانات في مانيتك بنجاح" : "Data synchronized with MANTIQ successfully.");
            state.isModalOpen = false;
            render();
        }

        function handleDelete(idx) {
            state.data[state.module][state.page].splice(idx, 1);
            pushNotify(state.language === 'ar' ? "تم حذف السجل من القاعدة" : "Record purged from database.");
            render();
        }

        // --- 5. Rendering ---

        function getLogo(sizeClass = "h-8") {
            return `<div class="flex items-center gap-1 ${sizeClass}"><span class="text-[1.2em] font-black tracking-tight text-mantiq-navy dark:text-white uppercase">MANTIQ</span></div>`;
        }

        function renderLanding() {
            const modulesHtml = Object.entries(SYSTEM_MAP).map(([id, cfg]) => `
                <button onclick="setModule('${id}')" class="group bg-white dark:bg-slate-900 p-8 md:p-12 rounded-[2.5rem] md:rounded-[3.5rem] border border-slate-200 dark:border-slate-800 shadow-sm card-glow transition-all text-left flex flex-col hover:-translate-y-2">
                    <div class="bg-mantiq-cyan text-white p-4 md:p-6 rounded-2xl md:rounded-[2rem] inline-block mb-6 md:mb-10 shadow-xl group-hover:scale-110 transition-transform">
                        <i data-lucide="${cfg.nav[0].icon}" class="w-6 h-6 md:w-9 md:h-9"></i>
                    </div>
                    <h3 class="text-2xl md:text-3xl font-extrabold text-mantiq-navy dark:text-white mb-2 md:mb-3 uppercase tracking-tighter leading-none">${_t(cfg.title.en, cfg.title.ar)}</h3>
                    <p class="text-slate-500 dark:text-slate-400 text-xs md:text-sm mb-8 md:mb-12 flex-1 leading-relaxed">${ut('description')}</p>
                    <div class="flex items-center text-mantiq-cyan font-black text-[10px] md:text-xs uppercase tracking-widest">
                        ${ut('launch')} <i data-lucide="arrow-right" class="mx-2 w-3 h-3 md:w-4 md:h-4 group-hover:translate-x-3 transition-transform ${state.language === 'ar' ? 'rotate-180' : ''}"></i>
                    </div>
                </button>
            `).join('');

            return `
                <div class="min-h-screen flex flex-col items-center justify-center py-20 px-6 md:p-8 fade-in bg-slate-50 dark:bg-slate-950 overflow-y-auto overflow-x-hidden">
                    <div class="absolute top-6 right-6 md:top-10 md:right-10 flex gap-4 z-50">
                        <button onclick="setLanguage('${state.language === 'en' ? 'ar' : 'en'}')" class="px-5 py-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl shadow-xl font-black text-xs uppercase tracking-tighter text-mantiq-navy dark:text-white transition-all">
                            ${state.language === 'en' ? 'Arabic' : 'English'}
                        </button>
                        <button onclick="toggleDarkMode()" class="p-3 md:p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-full shadow-xl hover:scale-110 transition-all">
                            <i data-lucide="${state.darkMode ? 'sun' : 'moon'}" class="w-6 h-6 ${state.darkMode ? 'text-amber-400' : 'text-mantiq-cyan'}"></i>
                        </button>
                    </div>
                    <div class="text-center mb-12 md:mb-20 max-w-4xl pt-10">
                        <div class="flex justify-center mb-6 md:mb-10 scale-125 md:scale-150">${getLogo("h-10 md:h-16 text-2xl md:text-5xl")}</div>
                        <h1 class="text-4xl md:text-7xl font-black text-mantiq-navy dark:text-white mb-4 md:mb-6 tracking-tight leading-none uppercase">${ut('subtitle')}</h1>
                        <p class="text-slate-500 dark:text-slate-400 text-sm md:text-xl font-medium px-4 md:px-12 leading-relaxed max-w-2xl mx-auto">${ut('description')}</p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 w-full max-w-7xl relative z-10 pb-12">
                        ${modulesHtml}
                    </div>
                </div>
            `;
        }

        function renderMobileNav() {
            const config = SYSTEM_MAP[state.module];
            return `
                <div class="fixed inset-0 z-[100] lg:hidden">
                    <div class="absolute inset-0 bg-mantiq-navy/60 backdrop-blur-sm" onclick="state.isMobileMenuOpen=false; render();"></div>
                    <div class="absolute ${state.language === 'en' ? 'left-0' : 'right-0'} top-0 h-full w-4/5 max-w-xs bg-white dark:bg-slate-900 shadow-2xl flex flex-col fade-in mobile-sidebar-active transition-transform duration-300">
                        <div class="p-8 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                            ${getLogo("h-6 text-lg")}
                            <button onclick="state.isMobileMenuOpen=false; render();" class="p-2 text-slate-400"><i data-lucide="x" size="24"></i></button>
                        </div>
                        <nav class="flex-1 p-6 space-y-1 overflow-y-auto custom-scrollbar">
                             <p class="px-6 py-4 text-[10px] font-black uppercase tracking-[0.3em] text-slate-400 opacity-60">${_t(config.title.en, config.title.ar)}</p>
                            ${config.nav.map(item => `
                                <button onclick="setPage('${item.id}')" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl text-sm font-bold transition-all ${state.page === item.id ? 'bg-mantiq-cyan text-white' : 'text-slate-500 hover:bg-slate-100'}">
                                    <i data-lucide="${item.icon}" size="18"></i><span>${_t(item.label.en, item.label.ar)}</span>
                                </button>
                            `).join('')}
                        </nav>
                    </div>
                </div>
            `;
        }

        function renderApp() {
            const config = SYSTEM_MAP[state.module];
            const navHtml = config.nav.map(item => `
                <button onclick="setPage('${item.id}')" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl text-sm font-bold transition-all ${state.page === item.id ? 'bg-mantiq-cyan text-white shadow-lg shadow-sky-500/30 ' + (state.language === 'en' ? 'translate-x-1' : '-translate-x-1') : 'text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800'}">
                    <i data-lucide="${item.icon}" size="18"></i>
                    <span class="whitespace-nowrap overflow-hidden text-ellipsis">${_t(item.label.en, item.label.ar)}</span>
                </button>
            `).join('');

            return `
                <div class="flex bg-slate-50 dark:bg-slate-950 transition-colors h-screen overflow-hidden">
                    <aside class="hidden lg:flex w-80 h-screen fixed ${state.language === 'en' ? 'left-0 border-r' : 'right-0 border-l'} top-0 border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 z-30 flex flex-col">
                        <div class="p-10 border-b border-slate-200 dark:border-slate-800"><button onclick="setModule(MODULES.LANDING)">${getLogo("h-8 text-xl")}</button></div>
                        <nav class="flex-1 p-6 space-y-1 overflow-y-auto custom-scrollbar">
                            <p class="px-6 py-4 text-[10px] font-black uppercase tracking-[0.3em] text-slate-400 opacity-60">${_t(config.title.en, config.title.ar)}</p>
                            ${navHtml}
                        </nav>
                        <div class="p-8 border-t border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-2xl bg-mantiq-navy text-white flex items-center justify-center font-black shadow-lg">AS</div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-black text-mantiq-navy dark:text-white truncate uppercase">${_t('Ahmed Sharaf', 'أحمد شرف')}</p>
                                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">${ut('role')}</p>
                                </div>
                                <button onclick="toggleDarkMode()" class="p-2.5 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm"><i data-lucide="${state.darkMode ? 'sun' : 'moon'}" size="16"></i></button>
                            </div>
                        </div>
                    </aside>

                    <div class="flex-1 ${state.language === 'en' ? 'lg:pl-80' : 'lg:pr-80'} h-screen overflow-y-auto custom-scrollbar relative">
                        <header class="h-28 bg-white/80 dark:bg-slate-950/80 backdrop-blur-3xl border-b border-slate-200 dark:border-slate-800 items-center justify-between px-14 sticky top-0 z-20 hidden lg:flex">
                            <div>
                                <div class="flex items-center gap-3 text-slate-400 text-[10px] font-black uppercase tracking-widest mb-1">
                                    <span>${ut('demoEnv')}</span><i data-lucide="chevron-right" size="12" class="${state.language === 'ar' ? 'rotate-180' : ''}"></i><span class="text-mantiq-cyan uppercase font-bold">${_t(config.title.en, config.title.ar)}</span>
                                </div>
                                <h1 class="text-3xl font-black text-mantiq-navy dark:text-white capitalize tracking-tighter">${_t(state.page.replace('_', ' '), config.nav.find(n=>n.id===state.page).label.ar)}</h1>
                            </div>
                            <div class="flex items-center gap-4">
                                <button onclick="setLanguage('${state.language === 'en' ? 'ar' : 'en'}')" class="font-black text-xs uppercase px-4 py-2 border border-slate-200 dark:border-slate-800 rounded-xl hover:bg-slate-50 transition-colors">${state.language === 'en' ? 'Arabic' : 'English'}</button>
                                <button class="relative p-3 text-slate-400 hover:text-mantiq-cyan"><i data-lucide="bell" size="22"></i><span class="absolute top-3 right-3 w-2.5 h-2.5 bg-rose-500 rounded-full border-2 border-white dark:border-slate-950"></span></button>
                                <button onclick="setModule(MODULES.LANDING)" class="p-3 text-slate-400 hover:text-rose-500"><i data-lucide="log-out" size="22"></i></button>
                            </div>
                        </header>

                        <!-- Mobile Header -->
                        <div class="lg:hidden flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 sticky top-0 z-30">
                             <button onclick="setModule(MODULES.LANDING)">${getLogo("h-6 text-lg")}</button>
                             <div class="flex items-center gap-3">
                                <button onclick="toggleMobileMenu()" class="p-2 bg-mantiq-cyan text-white rounded-lg"><i data-lucide="menu" size="18"></i></button>
                             </div>
                        </div>

                        <main class="p-6 md:p-14 max-w-[1500px] mx-auto fade-in">
                            ${renderWorkspace()}
                        </main>
                    </div>
                </div>
                ${state.isMobileMenuOpen ? renderMobileNav() : ''}
                ${state.isModalOpen ? renderModal() : ''}
            `;
        }

        function renderModal() {
            const currentNav = SYSTEM_MAP[state.module].nav.find(n => n.id === state.page);
            const colsEn = currentNav.tableCols.en;
            const colsAr = currentNav.tableCols.ar;

            const inputs = colsEn.map((col, idx) => `
                <div class="flex flex-col gap-2">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400">${_t(col, colsAr[idx])}</label>
                    <input type="text" name="${col}" placeholder="${_t('Enter ', 'أدخل ') + _t(col, colsAr[idx])}" class="bg-slate-50 dark:bg-slate-800 border-none rounded-2xl px-5 py-4 text-sm font-bold text-mantiq-navy dark:text-white outline-none focus:ring-2 focus:ring-mantiq-cyan" required />
                </div>
            `).join('');

            return `
                <div class="fixed inset-0 z-[101] flex items-center justify-center p-6 modal-overlay fade-in">
                    <div class="bg-white dark:bg-slate-900 w-full max-w-xl rounded-[2.5rem] p-10 border border-slate-200 dark:border-slate-800 shadow-2xl max-h-[85vh] overflow-y-auto custom-scrollbar">
                        <div class="flex justify-between items-start mb-8">
                            <div>
                                <h2 class="text-2xl font-black text-mantiq-navy dark:text-white uppercase tracking-tighter">${ut('addRecord')}</h2>
                                <p class="text-slate-500 text-xs mt-1 uppercase font-bold tracking-widest">${_t(currentNav.label.en, currentNav.label.ar)}</p>
                            </div>
                            <button onclick="state.isModalOpen=false; render();" class="text-slate-400 hover:text-rose-500 transition-colors"><i data-lucide="x" size="24"></i></button>
                        </div>
                        <form id="add-record-form" onsubmit="handleAddData(event)" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${inputs}
                            <div class="md:col-span-2 flex gap-3 mt-6">
                                <button type="button" onclick="state.isModalOpen=false; render();" class="flex-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 py-5 rounded-2xl font-black text-sm uppercase">${ut('cancel')}</button>
                                <button type="submit" class="flex-1 bg-mantiq-navy dark:bg-white text-white dark:text-mantiq-navy py-5 rounded-2xl font-black text-sm uppercase shadow-xl">${ut('submit')}</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderWorkspace() {
            const currentNav = SYSTEM_MAP[state.module].nav.find(n => n.id === state.page);
            if (state.page === 'dashboard') {
                return `
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-12">
                        <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm card-glow">
                            <h3 class="text-slate-500 text-[10px] font-bold uppercase mb-1">${ut('growth')}</h3>
                            <p class="text-3xl font-black text-mantiq-navy dark:text-white">+14.2%</p>
                        </div>
                        <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm card-glow">
                            <h3 class="text-slate-500 text-[10px] font-bold uppercase mb-1">${ut('volume')}</h3>
                            <p class="text-3xl font-black text-mantiq-navy dark:text-white">2.41M</p>
                        </div>
                        <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm card-glow">
                            <h3 class="text-slate-500 text-[10px] font-bold uppercase mb-1">${ut('assets')}</h3>
                            <p class="text-3xl font-black text-mantiq-navy dark:text-white">4,810</p>
                        </div>
                        <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm card-glow">
                            <h3 class="text-slate-500 text-[10px] font-bold uppercase mb-1">${ut('status')}</h3>
                            <p class="text-3xl font-black text-mantiq-cyan">${ut('verified')}</p>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-900 rounded-[3.5rem] p-20 border border-slate-200 dark:border-slate-800 text-center">
                        <div class="w-24 h-24 bg-sky-50 dark:bg-sky-900/30 rounded-[2rem] flex items-center justify-center mx-auto mb-10 text-mantiq-cyan animate-pulse"><i data-lucide="layout-dashboard" size="48"></i></div>
                        <h2 class="text-4xl font-black text-mantiq-navy dark:text-white mb-6 uppercase tracking-tighter">${ut('controlCenter')}</h2>
                        <p class="text-slate-500 dark:text-slate-400 text-lg max-w-2xl mx-auto leading-relaxed">${_t('Operating System localized for Egyptian markets.', 'نظام تشغيل مخصص للسوق المصري.')}</p>
                    </div>
                `;
            }

            const pageData = state.data[state.module][state.page] || [];
            const cols = _t(currentNav.tableCols.en, currentNav.tableCols.ar);
            const colsKeys = currentNav.tableCols.en;

            const rowsHtml = pageData.map((row, idx) => `
                <tr class="group hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-all border-b border-slate-50 dark:border-slate-800 last:border-0">
                    ${colsKeys.map(k => `<td class="px-10 py-7 font-bold text-slate-700 dark:text-slate-200 text-sm whitespace-nowrap">${row[k] || '-'}</td>`).join('')}
                    <td class="px-10 py-7 text-right whitespace-nowrap flex justify-end gap-3">
                        <button onclick="pushNotify('View Only Mode')" class="text-mantiq-cyan"><i data-lucide="eye" size="18"></i></button>
                        <button onclick="handleDelete(${idx})" class="text-slate-400 hover:text-rose-500"><i data-lucide="trash-2" size="18"></i></button>
                    </td>
                </tr>
            `).join('');

            return `
                <div class="flex flex-col md:flex-row justify-between md:items-center gap-4 mb-10">
                    <h2 class="text-3xl font-black text-mantiq-navy dark:text-white uppercase tracking-tighter">${_t(currentNav.label.en, currentNav.label.ar)}</h2>
                    <div class="flex gap-3">
                        <button onclick="pushNotify('${ut('export')}...')" class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 px-6 py-4 rounded-2xl font-black text-sm text-slate-600 dark:text-slate-300 shadow-sm">${ut('export')}</button>
                        <button onclick="state.isModalOpen=true; render();" class="bg-mantiq-navy dark:bg-white text-white dark:text-mantiq-navy px-8 py-4 rounded-2xl font-black text-sm shadow-xl">${ut('addRecord')}</button>
                    </div>
                </div>
                <div class="bg-white dark:bg-slate-900 rounded-[3rem] border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden overflow-x-auto custom-scrollbar">
                    <table class="w-full text-left border-collapse" dir="${state.language === 'ar' ? 'rtl' : 'ltr'}">
                        <thead class="bg-slate-50/50 dark:bg-slate-800/50 text-[10px] uppercase tracking-[0.2em] font-black text-slate-500">
                            <tr>
                                ${cols.map(c => `<th class="px-10 py-7 whitespace-nowrap">${c}</th>`).join('')}
                                <th class="px-10 py-7 ${state.language === 'en' ? 'text-right' : 'text-left'}">${ut('action')}</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100 dark:divide-slate-800">${rowsHtml || `<tr><td colspan="20" class="p-20 text-center italic text-slate-400">Empty View</td></tr>`}</tbody>
                    </table>
                </div>
            `;
        }

        function render() {
            const root = document.getElementById('app');
            root.innerHTML = (state.module === MODULES.LANDING) ? renderLanding() : renderApp();
            lucide.createIcons();
        }

        window.addEventListener('contextmenu', e => { e.preventDefault(); pushNotify(ut('restricted')); });
        window.onload = () => { initData(); render(); };
    </script>
</body>
</html>
